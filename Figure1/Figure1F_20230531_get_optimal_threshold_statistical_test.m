%{
----------------------------------------------------------------------------
Analyzing behavioral data
At least for the correct rate
----------------------------------------------------------------------------
%}
function Figure1F_20230531_get_optimal_threshold_statistical_test


a23 = ... 
[0.1066		0.2615			0.3276		0.3042
0.0611		0.2545			0.2658		0.3281
0.1034		0.4282			0.2251		0.3316
0.0012		0.3194			0.232		0.479
0.2108		0.3309			0.3777		0.4627
0.1337		0.3393			0.4025		0.3924
0.063		0.4203			0.3515		0.4014
0.1391		0.1831			0.3173		0.3132
0.0878		0.3523			0.252		0.4253
0.0339		0.2768			0.2935		0.3245
];
a25 = ...
[0.2376		0.1949			0.4423		0.4342
0.3455		0.521			0.2902		0.3285
0.2271		0.3247			0.3218		0.3814
-0.0267		0.4604			0.24		0.3041
0.1218		0.2689			0.2222		0.3429
0.1825		0.3893			0.3104		0.3228
0.1301		0.2769			0.2843		0.3497
0.1707		0.3542			0.3087		0.413
0.2951		0.4685			0.2684		0.3405
0.1324		0.4382			0.3033		0.3146
0.1229		0.4203			0.2631		0.376
0.1781		0.575			0.2453		0.3237
0.1641		0.5486			0.2712		0.3334
0.2395		0.3925			0.2376		0.383
0.0853		0.4359			0.2359		0.2985
0.1001		0.4903			0.2569		0.3237
0.1958		0.4232			0.225		0.3029
0.2883		0.5293			0.2496		0.359
0.104		0.3089			0.2737		0.3307
0.0991		0.4325			0.2427		0.3655
0.1546		0.4542			0.2501		0.3875
];
a26=...
[0.1865		0.409			0.3203		0.3931
0.1588		0.3143			0.2728		0.367
0.1884		0.3137			0.25		0.4467
0.0809		0.3376			0.2361		0.3599
0.1734		0.216			0.263		0.3634
0.062		0.3685			0.2705		0.3395
0.2201		0.3417			0.3197		0.4098
0.2332		0.4894			0.306		0.4011
0.0641		0.4489			0.3122		0.3596
0.233		0.3782			0.3016		0.3308
0.1118		0.4538			0.3027		0.3439
0.2513		0.4106			0.2928		0.45
0.3319		0.3765			0.3727		0.3731
0.072		0.3193			0.3085		0.4224
];
a30=...
[0.2007		0.4193			0.2546		0.4416
0.1901		0.237			0.278		0.4991
0.1		0.4168			0.3818		0.5453
0.2883		0.1847			0.317		0.3315
0.1756		0.3348			0.3027		0.4381
0.1912		0.4988			0.339		0.3597
0.2051		0.3963			0.3043		0.3469
0.2276		0.4118			0.243		0.3547
0.1861		0.1765			0.3737		0.4497
0.1794		0.5489			0.323		0.3849
0.2942		0.366			0.315		0.3686
0.2156		0.1114			0.2993		0.3166
];
fr00=...
[0.2053		0.1781			0.2556		0.3615
0.2889		0.3305			0.2632		0.3703
0.0576		0.4239			0.2786		0.3356
0.2136		0.1714			0.2469		0.3553
0.0827		0.4425			0.2408		0.338
0.1439		0.2751			0.2709		0.3689
0.2633		0.2139			0.3799		0.4
0.0811		0.5786			0.3059		0.4183
0.2033		0.4378			0.3005		0.3833
0.0856		0.2533			0.2635		0.3919
-0.0081		0.3405			0.2588		0.3876
0.0477		0.261			0.2578		0.3157
0.0794		0.3037			0.2983		0.3841
0.2869		0.0801			0.272		0.3862
0.1304		0.3172			0.2984		0.4108
0.0321		0.257			0.278		0.411
0.0709		0.1293			0.2591		0.3286
];
fr02=...
[-0.0269		0.2037			0.2638		0.3772
0.088		0.0831			0.27		0.3571
0.0827		0.3715			0.2994		0.4671
0.1688		0.1477			0.3143		0.3544
0.0123		0.2208			0.2698		0.3835
0.1151		0.0696			0.2414		0.321
0.1437		0.2867			0.2975		0.4104
0.1493		0.3605			0.2303		0.4676
0.1676		0.1474			0.2723		0.3687
];

[session_number(1),~] = size(a23);
[session_number(2),~] = size(a25);
[session_number(3),~] = size(a26);
[session_number(4),~] = size(a30);
[session_number(5),~] = size(fr00);
[session_number(6),~] = size(fr02);

stim_sabun = [a23(:,[1,3]);a25(:,[1,3]);a26(:,[1,3]);a30(:,[1,3]);fr00(:,[1,3]);fr02(:,[1,3])];
rew_sabun =  [a23(:,[2,4]);a25(:,[2,4]);a26(:,[2,4]);a30(:,[2,4]);fr00(:,[2,4]);fr02(:,[2,4])];

session_number = cumsum(session_number);

for i = 1:6
    if i == 1
        N_subject(1:session_number(i)) = i;
    else
        N_subject(session_number(i-1)+1:session_number(i)) = i;
    end
end
N_subject = N_subject';
stim_sabun = stim_sabun(:,1)-stim_sabun(:,2);
rew_sabun = rew_sabun(:,1)-rew_sabun(:,2);

disp('stim analysis')
signrank(stim_sabun)

lme = fitlme_analysis_20210520_0(stim_sabun,N_subject);
%lme(1).lme
lme(2).lme

disp('rew analysis')
signrank(rew_sabun)

lme = fitlme_analysis_20210520_0(rew_sabun,N_subject);
%lme(1).lme
lme(2).lme


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function r = find_max_psycho(para, use_uncertainty, stim_para, stim_prob, reward)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

r(1) = reward(1) .* stim_prob(1) .* stim_para(1) .* (1-1/(1+exp(para)));
r(2) = reward(1) .* stim_prob(1) .* stim_para(2) .* (1-1/(1+exp(-0.25*use_uncertainty+para)));
r(3) = reward(1) .* stim_prob(1) .* stim_para(3) .* (1-1/(1+exp(-0.45*use_uncertainty+para)));
r(4) = reward(2) .* stim_prob(2) .* stim_para(4) .* (1/(1+exp(-0.55*use_uncertainty+para)));
r(5) = reward(2) .* stim_prob(2) .* stim_para(5) .* (1/(1+exp(-0.75*use_uncertainty+para)));
r(6) = reward(2) .* stim_prob(2) .* stim_para(6) .* (1/(1+exp(-use_uncertainty+para)));

r = -sum(r);

return

